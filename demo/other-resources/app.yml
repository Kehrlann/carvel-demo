---
apiVersion: kappctrl.k14s.io/v1alpha1
kind: App
metadata:
  name: full-app
  namespace: default

spec:
  serviceAccountName: kapp-controller-sa
  syncPeriod: 30s
  fetch:
    - imgpkgBundle:
        image: docker.io/dgarnier963/carvel-demo:temp

          #- git:
          #    url: https://github.com/k14s/k8s-simple-app-example
          #    ref: origin/develop
          #    subPath: config-step-2-template

  template:
    # use ytt to template configuration
    - ytt:
        paths:
        - app/
        - app-private/
        - infra/
        valuesFrom:
          - secretRef:
              name: app-configuration


    # use kbld to resolve image references to use digests
    - kbld:
        # lists paths to use explicitly (optional; v0.13.0+)
        # - must be quoted when included with paths
        paths:
        - .imgpkg/images.yml
        - "-"

  deploy:
    - kapp: {}

---
apiVersion: v1
kind: Secret
metadata:
  name: app-configuration
  namespace: default
stringData:
  values.yml: |
    apps:
      - name: "fraises"
        html: |
          <body>
            <h1>Strawberries playing music together</h1>
            <p>They're jamming!</p>
          </body>
        public: true
      - name: "bananes"
        html: |
          <body>
            <h1>This is Bananas!</h1>
            <p>Seriously, this is bananas.</p>
          </body>
        public: false
      - name: "pommes"
        html: |
          <body>
            <h1>An apple a day keeps the doctor away</h1>
            <p>But only if you aim correctly and throw it really hard.</p>
          </body>
        public: false
